<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="#{page.dashboard.title}">Dashboard - Weather Mood Tracker</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body class="dashboard-page" th:attr="data-theme=${userTheme}, data-language=${userLanguage}">

<nav class="navbar">
    <h1 th:text="#{page.dashboard.navbar.title}">Weather Mood Tracker</h1>
    <div class="navbar-right">
        <!-- Settings Dropdown -->
        <div class="settings-dropdown">
            <button class="settings-btn" onclick="toggleSettings()">‚öôÔ∏è</button>
            <div id="settingsMenu" class="settings-menu">
                <div class="settings-section">
                    <h4 th:text="#{page.dashboard.settings.language}">Language</h4>
                    <a th:href="@{/dashboard(lang='pl')}"
                       class="setting-option"
                       th:classappend="${userLanguage == 'pl'} ? 'active' : ''">
                        Polski
                    </a>
                    <a th:href="@{/dashboard(lang='en')}"
                       class="setting-option"
                       th:classappend="${userLanguage == 'en'} ? 'active' : ''">
                        English
                    </a>
                </div>
                <div class="settings-divider"></div>
                <div class="settings-section">
                    <h4 th:text="#{page.dashboard.settings.theme}">Theme</h4>
                    <button class="setting-option"
                            onclick="changeTheme('light')"
                            th:attr="data-active=${userTheme == 'light'}">
                        <span th:text="#{page.dashboard.settings.theme.light}">Light</span>
                    </button>
                    <button class="setting-option"
                            onclick="changeTheme('dark')"
                            th:attr="data-active=${userTheme == 'dark'}">
                        <span th:text="#{page.dashboard.settings.theme.dark}">Dark</span>
                    </button>
                </div>
            </div>
        </div>
        <a th:href="@{/logout}" class="logout-btn" th:text="#{page.dashboard.logout}">Logout</a>
    </div>
</nav>

<div class="dashboard-container">
    <div class="welcome-card">
        <h2 th:text="#{page.dashboard.heading}">Panel!</h2>
        <p class="welcome-message" th:text="#{page.dashboard.welcome(${user.username})}">Witaj, username!</p>
        <p th:text="#{page.dashboard.success.message}">You have successfully logged in.</p>

        <div class="user-info">
            <p>
                <strong th:text="#{page.dashboard.username}">Username:</strong>
                <span th:text="${user.username}"></span>
            </p>
            <p>
                <strong th:text="#{page.dashboard.email}">Email:</strong>
                <span th:text="${user.email}"></span>
            </p>
            <p th:if="${user.city}">
                <strong th:text="#{page.dashboard.city}">City:</strong>
                <span th:text="${user.city}"></span>
            </p>
            <p>
                <strong th:text="#{page.dashboard.member.since}">Member since:</strong>
                <span th:text="${#temporals.format(user.createdAt, 'dd-MM-yyyy HH:mm')}"></span>
            </p>
        </div>

        <div class="calendar-wrapper">
            <div id="calendar" class="calendar-component">
                <div class="calendar-header">
                    <button id="prevMonth">&lt;</button>
                    <h2 id="monthLabel"></h2>
                    <button id="nextMonth">&gt;</button>
                    <button id="todayBtn" th:text="#{calendar.today}">Today</button>
                </div>
                <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <div id="dayModal" class="calendar-modal">
                <div id="dayModalContent" class="modal-content-scrollable">
                    <span id="closeModal">&times;</span>
                    <h3 id="modalDateTitle">Date</h3>

                    <div id="futureView" style="display: none; text-align: center; padding: 20px;">
                        <p th:text="#{modal.future}">This day hasn't arrived yet. Come back later to save the mood!</p>
                    </div>

                    <div id="readOnlyView" style="display: none;" th:attr="nodata=#{modal.nodata}">
                        <h4 th:text="#{modal.summary}">Summary of the day:</h4>
                        <div class="readonly-section">
                            <strong th:text="#{modal.mood}">Mood:</strong> <span id="roMood" th:text="#{modal.nodata}">No data</span> <span id="roMoodEmoji"></span>
                            <p id="roComment" style="font-style: italic; color: #888;"></p>
                        </div>
                        <div class="readonly-section">
                            <strong th:text="#{modal.weather}">Weather:</strong> <span id="roWeather" th:text="#{modal.nodata}">No data</span>
                        </div>
                        <div class="readonly-section">
                            <strong th:text="#{modal.water}">Water:</strong> <span id="roWater">0</span> ml üíß
                        </div>
                        <div class="readonly-section">
                            <strong th:text="#{modal.activity}">Activity:</strong> <span id="roActivity" th:text="#{modal.nodata}">No data</span>
                        </div>
                    </div>

                    <div id="editView" style="display: none;">

                        <h4 th:text="#{mood.form.heading}" style="text-align: center; margin-bottom: 20px;">Mood</h4>

                        <div id="moodAlert" class="alert" style="display: none;"></div>

                        <form id="moodForm" th:action="@{/dashboard/mood}" th:object="${moodEntry}" method="post" class="mood-form">
                            <div class="form-group">
                                <div class="mood-rating-container">
                                    <div class="mood-option">
                                        <input type="radio" id="mood1" th:field="*{moodLevel}" value="1" required>
                                        <label for="mood1">
                                            <span class="emoji">üòû</span>
                                        </label>
                                    </div>

                                    <div class="mood-option">
                                        <input type="radio" id="mood2" th:field="*{moodLevel}" value="2">
                                        <label for="mood2">
                                            <span class="emoji">üòï</span>
                                        </label>
                                    </div>

                                    <div class="mood-option">
                                        <input type="radio" id="mood3" th:field="*{moodLevel}" value="3">
                                        <label for="mood3">
                                            <span class="emoji">üòê</span>
                                        </label>
                                    </div>

                                    <div class="mood-option">
                                        <input type="radio" id="mood4" th:field="*{moodLevel}" value="4">
                                        <label for="mood4">
                                            <span class="emoji">üôÇ</span>
                                        </label>
                                    </div>

                                    <div class="mood-option">
                                        <input type="radio" id="mood5" th:field="*{moodLevel}" value="5">
                                        <label for="mood5">
                                            <span class="emoji">üòÑ</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <label for="comment" th:text="#{mood.form.comment.label}" style="display: block; margin-top: 20px; margin-bottom: 5px; font-weight: bold;">Note (optional):</label>
                            <textarea id="comment" th:field="*{comment}" rows="3" th:placeholder="#{mood.form.comment.placeholder}" style="width: 100%; margin-top: 15px;"></textarea>
                            <button type="submit" class="btn btn-sm" th:text="#{mood.form.submit}">Save</button>
                        </form>

                        <div class="section-divider"></div>

                        <h4 th:text="#{hydration.form.title}" style="text-align: center; margin-bottom: 20px;">Hydration</h4>

                        <div id="hydrationAlert" class="alert" style="display: none;"></div>

                        <form id="hydrationForm" th:action="@{/dashboard/hydration}" th:object="${hydrationEntry}" method="post">
                            <h2 id="waterDisplay" style="text-align: center; color: #2196F3; margin: 5px 0;">0 ml</h2>
                            <div class="water-tracker">
                                <span class="water-glass" th:each="i : ${#numbers.sequence(1, 10)}">ü•õ</span>
                            </div>
                            <input type="hidden" id="waterAmountInput" th:field="*{amountMl}" required>
                            <button type="submit" class="btn btn-sm" th:text="#{hydration.btn}">Add</button>
                        </form>

                        <div class="section-divider"></div>

                        <h4 th:text="#{activity.form.title}" style="text-align: center; margin-bottom: 20px;">Activity</h4>

                        <div id="activityAlert" class="alert" style="display: none;"></div>

                        <form id="activityForm" th:action="@{/dashboard/activity}" th:object="${activityEntry}" method="post">
                            <div class="icon-selection small-icons">
                                <div th:each="type : ${T(pl.pollub.weather_mood_tracker.model.enums.ActivityType).values()}">
                                    <input type="checkbox" th:field="*{activityTypes}" th:value="${type}" th:id="${'activity-' + type.name()}">
                                    <label th:for="${'activity-' + type.name()}">
                                        <span class="emoji" th:switch="${type.name()}">
                                            <span th:case="'WALKING'">üö∂</span>
                                            <span th:case="'RUNNING'">üèÉ</span>
                                            <span th:case="'CYCLING'">üö¥</span>
                                            <span th:case="'SWIMMING'">üèä</span>
                                            <span th:case="'GYM'">üèãÔ∏è</span>
                                            <span th:case="'YOGA'">üßò</span>
                                            <span th:case="'BALLGAME'">‚öΩ</span>
                                            <span th:case="'OTHER'">ü§∏</span>
                                        </span>
                                    </label>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-sm" th:text="#{activity.btn}">Save</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <h3 th:text="#{page.dashboard.location}">Your location</h3>
        <div id="map" style="height: 300px; width: 100%; border-radius: 8px;"
             th:attr="data-city=${#strings.isEmpty(user.city) ? 'Warszawa' : user.city},
              data-city-custom=${!#strings.isEmpty(user.city)},
              data-label-user-city=#{page.dashboard.user_city},
              data-label-default-city=#{page.dashboard.default_city},
              data-label-error-loading=#{page.dashboard.error.loading}">
        </div>
    </div>
</div>
<script th:src="@{/js/theme-manager.js}"></script>
<script th:src="@{/js/location-manager.js}"></script>
<script th:inline="javascript">
    const dayNames = [
        /*[[#{day.Monday}]]*/,
        /*[[#{day.Tuesday}]]*/,
        /*[[#{day.Wednesday}]]*/,
        /*[[#{day.Thursday}]]*/,
        /*[[#{day.Friday}]]*/,
        /*[[#{day.Saturday}]]*/,
        /*[[#{day.Sunday}]]*/
    ];

    const monthNames = [
        /*[[#{month.January}]]*/,
        /*[[#{month.February}]]*/,
        /*[[#{month.March}]]*/,
        /*[[#{month.April}]]*/,
        /*[[#{month.May}]]*/,
        /*[[#{month.June}]]*/,
        /*[[#{month.July}]]*/,
        /*[[#{month.August}]]*/,
        /*[[#{month.September}]]*/,
        /*[[#{month.October}]]*/,
        /*[[#{month.November}]]*/,
        /*[[#{month.December}]]*/
    ];
</script>
<script th:src="@{/js/calendar-wrapper.js}"></script>
<script th:src="@{/js/water-tracker.js}"></script>
<script th:src="@{/js/ajax-forms.js}"></script>
</body>
</html>